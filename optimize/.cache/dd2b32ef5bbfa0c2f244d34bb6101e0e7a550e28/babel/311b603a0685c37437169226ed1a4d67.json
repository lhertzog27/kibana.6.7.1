{"remainingRequest":"/home/anthony/git_workspaces/kibana/node_modules/thread-loader/dist/cjs.js??ref--9-1!/home/anthony/git_workspaces/kibana/node_modules/babel-loader/lib/index.js??ref--9-2!/home/anthony/git_workspaces/kibana/x-pack/plugins/canvas/public/components/workpad_loader/index.js","dependencies":[{"path":"/home/anthony/git_workspaces/kibana/x-pack/plugins/canvas/public/components/workpad_loader/index.js","mtime":1567631711929},{"path":"/home/anthony/git_workspaces/kibana/node_modules/cache-loader/dist/cjs.js","mtime":1567666236302},{"path":"/home/anthony/git_workspaces/kibana/node_modules/thread-loader/dist/cjs.js","mtime":1567666239443},{"path":"/home/anthony/git_workspaces/kibana/node_modules/babel-loader/lib/index.js","mtime":1567666227676}],"contextDependencies":[],"result":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.WorkpadLoader = undefined;\n\nvar _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"]) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); } }; }();\n\nvar _propTypes = require('prop-types');\n\nvar _propTypes2 = _interopRequireDefault(_propTypes);\n\nvar _reactRedux = require('react-redux');\n\nvar _recompose = require('recompose');\n\nvar _workpad_service = require('../../lib/workpad_service');\n\nvar workpadService = _interopRequireWildcard(_workpad_service);\n\nvar _notify = require('../../lib/notify');\n\nvar _app = require('../../state/selectors/app');\n\nvar _workpad = require('../../state/selectors/workpad');\n\nvar _get_id = require('../../lib/get_id');\n\nvar _transient = require('../../state/actions/transient');\n\nvar _download_workpad = require('../../lib/download_workpad');\n\nvar _workpad_loader = require('./workpad_loader');\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _asyncToGenerator(fn) { return function () { var gen = fn.apply(this, arguments); return new Promise(function (resolve, reject) { function step(key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { return Promise.resolve(value).then(function (value) { step(\"next\", value); }, function (err) { step(\"throw\", err); }); } } return step(\"next\"); }); }; } /*\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * or more contributor license agreements. Licensed under the Elastic License;\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                            * you may not use this file except in compliance with the Elastic License.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                            */\n\nvar mapStateToProps = function mapStateToProps(state) {\n  return {\n    workpadId: (0, _workpad.getWorkpad)(state).id,\n    canUserWrite: (0, _app.canUserWrite)(state)\n  };\n};\n\nvar mapDispatchToProps = function mapDispatchToProps(dispatch) {\n  return {\n    setCanUserWrite: function setCanUserWrite(canUserWrite) {\n      return dispatch((0, _transient.setCanUserWrite)(canUserWrite));\n    }\n  };\n};\n\nvar WorkpadLoader = exports.WorkpadLoader = (0, _recompose.compose)((0, _recompose.getContext)({\n  router: _propTypes2.default.object\n}), (0, _reactRedux.connect)(mapStateToProps, mapDispatchToProps), (0, _recompose.withState)('workpads', 'setWorkpads', null), (0, _recompose.withHandlers)({\n  // Workpad creation via navigation\n  createWorkpad: function createWorkpad(props) {\n    return function () {\n      var _ref = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee(workpad) {\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                if (!(workpad != null)) {\n                  _context.next = 12;\n                  break;\n                }\n\n                _context.prev = 1;\n                _context.next = 4;\n                return workpadService.create(workpad);\n\n              case 4:\n                props.router.navigateTo('loadWorkpad', { id: workpad.id, page: 1 });\n                _context.next = 11;\n                break;\n\n              case 7:\n                _context.prev = 7;\n                _context.t0 = _context['catch'](1);\n\n                _notify.notify.error(_context.t0, { title: 'Couldn\\'t upload workpad' });\n                // TODO: remove this and switch to checking user privileges when canvas loads when granular app privileges are introduced\n                // https://github.com/elastic/kibana/issues/20277\n                if (_context.t0.response && _context.t0.response.status === 403) {\n                  props.setCanUserWrite(false);\n                }\n\n              case 11:\n                return _context.abrupt('return');\n\n              case 12:\n\n                props.router.navigateTo('createWorkpad');\n\n              case 13:\n              case 'end':\n                return _context.stop();\n            }\n          }\n        }, _callee, undefined, [[1, 7]]);\n      }));\n\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }();\n  },\n\n  // Workpad search\n  findWorkpads: function findWorkpads(_ref2) {\n    var setWorkpads = _ref2.setWorkpads;\n    return function () {\n      var _ref3 = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2(text) {\n        var workpads;\n        return regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.prev = 0;\n                _context2.next = 3;\n                return workpadService.find(text);\n\n              case 3:\n                workpads = _context2.sent;\n\n                setWorkpads(workpads);\n                _context2.next = 10;\n                break;\n\n              case 7:\n                _context2.prev = 7;\n                _context2.t0 = _context2['catch'](0);\n\n                _notify.notify.error(_context2.t0, { title: 'Couldn\\'t find workpads' });\n\n              case 10:\n              case 'end':\n                return _context2.stop();\n            }\n          }\n        }, _callee2, undefined, [[0, 7]]);\n      }));\n\n      return function (_x2) {\n        return _ref3.apply(this, arguments);\n      };\n    }();\n  },\n\n  // Workpad import/export methods\n  downloadWorkpad: function downloadWorkpad() {\n    return function (workpadId) {\n      return (0, _download_workpad.downloadWorkpad)(workpadId);\n    };\n  },\n\n  // Clone workpad given an id\n  cloneWorkpad: function cloneWorkpad(props) {\n    return function () {\n      var _ref4 = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee3(workpadId) {\n        var workpad;\n        return regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _context3.prev = 0;\n                _context3.next = 3;\n                return workpadService.get(workpadId);\n\n              case 3:\n                workpad = _context3.sent;\n\n                workpad.name += ' - Copy';\n                workpad.id = (0, _get_id.getId)('workpad');\n                _context3.next = 8;\n                return workpadService.create(workpad);\n\n              case 8:\n                props.router.navigateTo('loadWorkpad', { id: workpad.id, page: 1 });\n                _context3.next = 15;\n                break;\n\n              case 11:\n                _context3.prev = 11;\n                _context3.t0 = _context3['catch'](0);\n\n                _notify.notify.error(_context3.t0, { title: 'Couldn\\'t clone workpad' });\n                // TODO: remove this and switch to checking user privileges when canvas loads when granular app privileges are introduced\n                // https://github.com/elastic/kibana/issues/20277\n                if (_context3.t0.response && _context3.t0.response.status === 403) {\n                  props.setCanUserWrite(false);\n                }\n\n              case 15:\n              case 'end':\n                return _context3.stop();\n            }\n          }\n        }, _callee3, undefined, [[0, 11]]);\n      }));\n\n      return function (_x3) {\n        return _ref4.apply(this, arguments);\n      };\n    }();\n  },\n\n  // Remove workpad given an array of id\n  removeWorkpads: function removeWorkpads(props) {\n    return function () {\n      var _ref5 = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee4(workpadIds) {\n        var setWorkpads, workpads, loadedWorkpad, removeWorkpads;\n        return regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                setWorkpads = props.setWorkpads, workpads = props.workpads, loadedWorkpad = props.workpadId;\n                removeWorkpads = workpadIds.map(function (id) {\n                  return workpadService.remove(id).then(function () {\n                    return { id: id, err: null };\n                  }).catch(function (err) {\n                    return {\n                      id: id,\n                      err: err\n                    };\n                  });\n                });\n                return _context4.abrupt('return', Promise.all(removeWorkpads).then(function (results) {\n                  var redirectHome = false;\n\n                  var _results$reduce = results.reduce(function (_ref6, result) {\n                    var _ref7 = _slicedToArray(_ref6, 2),\n                        passes = _ref7[0],\n                        errors = _ref7[1];\n\n                    if (result.id === loadedWorkpad && !result.err) {\n                      redirectHome = true;\n                    }\n\n                    if (result.err) {\n                      errors.push(result.id);\n                      // TODO: remove this and switch to checking user privileges when canvas loads when granular app privileges are introduced\n                      // https://github.com/elastic/kibana/issues/20277\n                      if (result.err.response && result.err.response.status === 403) {\n                        props.setCanUserWrite(false);\n                      }\n                    } else {\n                      passes.push(result.id);\n                    }\n\n                    return [passes, errors];\n                  }, [[], []]),\n                      _results$reduce2 = _slicedToArray(_results$reduce, 2),\n                      passes = _results$reduce2[0],\n                      errors = _results$reduce2[1];\n\n                  var remainingWorkpads = workpads.workpads.filter(function (_ref8) {\n                    var id = _ref8.id;\n                    return !passes.includes(id);\n                  });\n\n                  var workpadState = {\n                    total: remainingWorkpads.length,\n                    workpads: remainingWorkpads\n                  };\n\n                  if (errors.length > 0) {\n                    _notify.notify.error(\"Couldn't delete all workpads\");\n                  }\n\n                  setWorkpads(workpadState);\n\n                  if (redirectHome) {\n                    props.router.navigateTo('home');\n                  }\n\n                  return errors.map(function (_ref9) {\n                    var id = _ref9.id;\n                    return id;\n                  });\n                }));\n\n              case 3:\n              case 'end':\n                return _context4.stop();\n            }\n          }\n        }, _callee4, undefined);\n      }));\n\n      return function (_x4) {\n        return _ref5.apply(this, arguments);\n      };\n    }();\n  }\n}))(_workpad_loader.WorkpadLoader);",null]}