{"remainingRequest":"/home/anthony/git_workspaces/kibana/node_modules/thread-loader/dist/cjs.js??ref--9-1!/home/anthony/git_workspaces/kibana/node_modules/babel-loader/lib/index.js??ref--9-2!/home/anthony/git_workspaces/kibana/x-pack/plugins/ml/public/components/rule_editor/select_rule_action/rule_action_panel.js","dependencies":[{"path":"/home/anthony/git_workspaces/kibana/x-pack/plugins/ml/public/components/rule_editor/select_rule_action/rule_action_panel.js","mtime":1567631712036},{"path":"/home/anthony/git_workspaces/kibana/node_modules/cache-loader/dist/cjs.js","mtime":1567666236302},{"path":"/home/anthony/git_workspaces/kibana/node_modules/thread-loader/dist/cjs.js","mtime":1567666239443},{"path":"/home/anthony/git_workspaces/kibana/node_modules/babel-loader/lib/index.js","mtime":1567666227676}],"contextDependencies":[],"result":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.RuleActionPanel = undefined;\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _propTypes = require('prop-types');\n\nvar _propTypes2 = _interopRequireDefault(_propTypes);\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _eui = require('@elastic/eui');\n\nvar _lodash = require('lodash');\n\nvar _add_to_filter_list_link = require('./add_to_filter_list_link');\n\nvar _delete_rule_modal = require('./delete_rule_modal');\n\nvar _edit_condition_link = require('./edit_condition_link');\n\nvar _utils = require('../utils');\n\nvar _ml_api_service = require('../../../services/ml_api_service');\n\nvar _react3 = require('@kbn/i18n/react');\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; } /*\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * or more contributor license agreements. Licensed under the Elastic License;\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * you may not use this file except in compliance with the Elastic License.\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                */\n\n/*\n * Panel with a description of a rule and a list of actions that can be performed on the rule.\n */\n\nvar RuleActionPanel = exports.RuleActionPanel = function (_Component) {\n  _inherits(RuleActionPanel, _Component);\n\n  function RuleActionPanel(props) {\n    _classCallCheck(this, RuleActionPanel);\n\n    var _this = _possibleConstructorReturn(this, (RuleActionPanel.__proto__ || Object.getPrototypeOf(RuleActionPanel)).call(this, props));\n\n    _initialiseProps.call(_this);\n\n    var _this$props = _this.props,\n        job = _this$props.job,\n        anomaly = _this$props.anomaly,\n        ruleIndex = _this$props.ruleIndex;\n\n\n    var detector = job.analysis_config.detectors[anomaly.detectorIndex];\n    var rules = detector.custom_rules;\n    if (rules !== undefined && ruleIndex < rules.length) {\n      _this.rule = rules[ruleIndex];\n    }\n\n    _this.state = {\n      showAddToFilterListLink: false\n    };\n    return _this;\n  }\n\n  _createClass(RuleActionPanel, [{\n    key: 'componentDidMount',\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      // If the rule has a scope section with a single partitioning field key,\n      // load the filter list to check whether to add a link to add the\n      // anomaly partitioning field value to the filter list.\n      var scope = this.rule.scope;\n      if (scope !== undefined && Object.keys(scope).length === 1) {\n        var partitionFieldName = Object.keys(scope)[0];\n        var partitionFieldValue = this.props.anomaly.source[partitionFieldName];\n\n        if (scope[partitionFieldName] !== undefined && partitionFieldValue !== undefined && partitionFieldValue.length === 1 && partitionFieldValue[0].length > 0) {\n\n          var filterId = scope[partitionFieldName].filter_id;\n          _ml_api_service.ml.filters.filters({ filterId: filterId }).then(function (filter) {\n            var filterItems = filter.items;\n            if (filterItems.indexOf(partitionFieldValue[0]) === -1) {\n              _this2.setState({ showAddToFilterListLink: true });\n            }\n          }).catch(function (resp) {\n            console.log('Error loading filter ' + filterId + ':', resp);\n          });\n        }\n      }\n    }\n  }, {\n    key: 'render',\n    value: function render() {\n      if (this.rule === undefined) {\n        return null;\n      }\n\n      // Add items for the standard Edit and Delete links.\n      var descriptionListItems = [{\n        title: _react2.default.createElement(_react3.FormattedMessage, { id: 'xpack.ml.ruleEditor.ruleActionPanel.ruleTitle', defaultMessage: 'rule' }),\n        description: (0, _utils.buildRuleDescription)(this.rule, this.props.anomaly)\n      }, {\n        title: '',\n        description: this.getEditRuleLink()\n      }, {\n        title: '',\n        description: this.getDeleteRuleLink()\n      }];\n\n      // Insert links if applicable for quick edits to a numeric condition\n      // or to the safe list used by the scope.\n      var quickConditionLink = this.getQuickEditConditionLink();\n      if (quickConditionLink !== null) {\n        descriptionListItems.splice(1, 0, {\n          title: '', description: quickConditionLink\n        });\n      }\n\n      if (this.state.showAddToFilterListLink === true) {\n        var quickAddToFilterListLink = this.getQuickAddToFilterListLink();\n        descriptionListItems.splice(descriptionListItems.length - 2, 0, {\n          title: '', description: quickAddToFilterListLink\n        });\n      }\n\n      descriptionListItems[1].title = 'actions';\n\n      return _react2.default.createElement(\n        _eui.EuiPanel,\n        { paddingSize: 'm', className: 'select-rule-action-panel' },\n        _react2.default.createElement(_eui.EuiDescriptionList, {\n          type: 'column',\n          listItems: descriptionListItems\n        })\n      );\n    }\n  }]);\n\n  return RuleActionPanel;\n}(_react.Component);\n\nvar _initialiseProps = function _initialiseProps() {\n  var _this3 = this;\n\n  this.getEditRuleLink = function () {\n    var _props = _this3.props,\n        ruleIndex = _props.ruleIndex,\n        setEditRuleIndex = _props.setEditRuleIndex;\n\n    return _react2.default.createElement(\n      _eui.EuiLink,\n      {\n        onClick: function onClick() {\n          return setEditRuleIndex(ruleIndex);\n        }\n      },\n      _react2.default.createElement(_react3.FormattedMessage, {\n        id: 'xpack.ml.ruleEditor.ruleActionPanel.editRuleLinkText',\n        defaultMessage: 'Edit rule'\n      })\n    );\n  };\n\n  this.getDeleteRuleLink = function () {\n    var _props2 = _this3.props,\n        ruleIndex = _props2.ruleIndex,\n        deleteRuleAtIndex = _props2.deleteRuleAtIndex;\n\n    return _react2.default.createElement(_delete_rule_modal.DeleteRuleModal, {\n      ruleIndex: ruleIndex,\n      deleteRuleAtIndex: deleteRuleAtIndex\n    });\n  };\n\n  this.getQuickEditConditionLink = function () {\n    // Returns the link to adjust the numeric value of a condition\n    // if the rule has a single numeric condition.\n    var conditions = _this3.rule.conditions;\n    var link = null;\n    if (_this3.rule.conditions !== undefined && conditions.length === 1) {\n      link = _react2.default.createElement(_edit_condition_link.EditConditionLink, {\n        conditionIndex: 0,\n        conditionValue: conditions[0].value,\n        appliesTo: conditions[0].applies_to,\n        anomaly: _this3.props.anomaly,\n        updateConditionValue: _this3.updateConditionValue\n      });\n    }\n\n    return link;\n  };\n\n  this.getQuickAddToFilterListLink = function () {\n    // Returns the link to add the partitioning field value of the anomaly to the filter\n    // list used in the scope part of the rule.\n\n    // Note componentDidMount performs the checks for the existence of scope and partitioning fields.\n    var _props3 = _this3.props,\n        anomaly = _props3.anomaly,\n        addItemToFilterList = _props3.addItemToFilterList;\n\n    var scope = _this3.rule.scope;\n    var partitionFieldName = Object.keys(scope)[0];\n    var partitionFieldValue = anomaly.source[partitionFieldName];\n    var filterId = scope[partitionFieldName].filter_id;\n\n    // Partitioning field values stored under named field in anomaly record will be an array.\n    return _react2.default.createElement(_add_to_filter_list_link.AddToFilterListLink, {\n      fieldValue: partitionFieldValue[0],\n      filterId: filterId,\n      addItemToFilterList: addItemToFilterList\n    });\n  };\n\n  this.updateConditionValue = function (conditionIndex, value) {\n    var _props4 = _this3.props,\n        job = _props4.job,\n        anomaly = _props4.anomaly,\n        ruleIndex = _props4.ruleIndex,\n        updateRuleAtIndex = _props4.updateRuleAtIndex;\n\n\n    var detector = job.analysis_config.detectors[anomaly.detectorIndex];\n    var editedRule = (0, _lodash.cloneDeep)(detector.custom_rules[ruleIndex]);\n\n    var conditions = editedRule.conditions;\n    if (conditionIndex < conditions.length) {\n      conditions[conditionIndex].value = value;\n    }\n\n    updateRuleAtIndex(ruleIndex, editedRule);\n  };\n};\n\nRuleActionPanel.propTypes = {\n  job: _propTypes2.default.object.isRequired,\n  anomaly: _propTypes2.default.object.isRequired,\n  ruleIndex: _propTypes2.default.number.isRequired,\n  setEditRuleIndex: _propTypes2.default.func.isRequired,\n  updateRuleAtIndex: _propTypes2.default.func.isRequired,\n  deleteRuleAtIndex: _propTypes2.default.func.isRequired,\n  addItemToFilterList: _propTypes2.default.func.isRequired\n};",null]}