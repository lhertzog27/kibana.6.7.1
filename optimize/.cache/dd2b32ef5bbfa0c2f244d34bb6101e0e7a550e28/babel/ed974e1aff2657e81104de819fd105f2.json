{"remainingRequest":"/home/anthony/git_workspaces/kibana/node_modules/thread-loader/dist/cjs.js??ref--9-1!/home/anthony/git_workspaces/kibana/node_modules/babel-loader/lib/index.js??ref--9-2!/home/anthony/git_workspaces/kibana/x-pack/plugins/ml/public/jobs/new_job/simple/single_metric/create_job/create_job_chart_directive.js","dependencies":[{"path":"/home/anthony/git_workspaces/kibana/x-pack/plugins/ml/public/jobs/new_job/simple/single_metric/create_job/create_job_chart_directive.js","mtime":1567631712060},{"path":"/home/anthony/git_workspaces/kibana/node_modules/cache-loader/dist/cjs.js","mtime":1567666236302},{"path":"/home/anthony/git_workspaces/kibana/node_modules/thread-loader/dist/cjs.js","mtime":1567666239443},{"path":"/home/anthony/git_workspaces/kibana/node_modules/babel-loader/lib/index.js","mtime":1567666227676}],"contextDependencies":[],"result":["'use strict';\n\nvar _jquery = require('jquery');\n\nvar _jquery2 = _interopRequireDefault(_jquery);\n\nvar _d = require('d3');\n\nvar _d2 = _interopRequireDefault(_d);\n\nvar _angular = require('angular');\n\nvar _angular2 = _interopRequireDefault(_angular);\n\nvar _moment = require('moment');\n\nvar _moment2 = _interopRequireDefault(_moment);\n\nvar _time_buckets = require('ui/time_buckets');\n\nvar _chart_utils = require('plugins/ml/util/chart_utils');\n\nvar _modules = require('ui/modules');\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar _module = _modules.uiModules.get('apps/ml'); /*\n                                                  * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n                                                  * or more contributor license agreements. Licensed under the Elastic License;\n                                                  * you may not use this file except in compliance with the Elastic License.\n                                                  */\n\n/*\n * Chart showing metric, annotated with anomalies.\n */\n\n_module.directive('mlSingleMetricJobChart', function () {\n\n  function link(scope, element) {\n\n    var svgWidth = _angular2.default.element('.single-metric-job-container').width();\n    var lineChartHeight = scope.chartHeight;\n    var swimlaneHeight = 30;\n    var margin = { top: 0, right: 0, bottom: 0, left: scope.chartTicksMargin.width };\n    var svgHeight = lineChartHeight + swimlaneHeight + margin.top + margin.bottom;\n    var vizWidth = svgWidth - margin.left - margin.right;\n    var chartLimits = { max: 0, min: 0 };\n\n    var lineChartXScale = null;\n    var lineChartYScale = null;\n\n    // TODO - do we want to use interpolate('basis') to smooth the connecting lines?\n    var lineChartValuesLine = null;\n    var lineChartBoundedArea = null;\n\n    var lineChartGroup = void 0;\n    var modelChartGroup = void 0;\n    var swimlaneGroup = void 0;\n    // let dotChartGroup;\n\n    var $progressBar = void 0;\n\n    scope.$on('render', function () {\n      init();\n      createSVGGroups();\n      drawLineChart();\n    });\n\n    scope.$on('render-results', function () {\n      drawResults();\n    });\n\n    element.on('$destroy', function () {\n      scope.$destroy();\n    });\n\n    function init() {\n      margin.left = scope.chartTicksMargin.width;\n      vizWidth = svgWidth - margin.left - margin.right;\n\n      lineChartXScale = _d2.default.time.scale().range([0, vizWidth]);\n      lineChartYScale = _d2.default.scale.linear().range([lineChartHeight, 0]);\n\n      // TODO - do we want to use interpolate('basis') to smooth the connecting lines?\n      lineChartValuesLine = _d2.default.svg.line().x(function (d) {\n        return lineChartXScale(d.date);\n      }).y(function (d) {\n        return lineChartYScale(d.value);\n      }).defined(function (d) {\n        return d.value !== null;\n      });\n      lineChartBoundedArea = _d2.default.svg.area().x(function (d) {\n        return lineChartXScale(d.date) || 0;\n      }).y0(function (d) {\n        return lineChartYScale(Math.max(chartLimits.min, Math.min(chartLimits.max, d.upper)));\n      }).y1(function (d) {\n        return lineChartYScale(Math.min(chartLimits.max, Math.max(chartLimits.min, d.lower)));\n      });\n    }\n\n    function createSVGGroups() {\n      if (scope.chartData.line === undefined) {\n        return;\n      }\n\n      // Clear any existing elements from the visualization,\n      // then build the svg elements for the bubble chart.\n      var chartElement = _d2.default.select(element.get(0));\n      chartElement.select('svg').remove();\n      chartElement.select('.progress').remove();\n\n      if (chartElement.select('.progress-bar')[0][0] === null) {\n        var style = 'width: ' + (+vizWidth + 2) + 'px;\\n          margin-bottom: -' + (+lineChartHeight + 5) + 'px;\\n          margin-left: ' + (+margin.left - 1) + 'px;\\'';\n\n        chartElement.append('div').attr('class', 'progress').attr('style', style).append('div').attr('class', 'progress-bar');\n      }\n\n      $progressBar = (0, _jquery2.default)('.progress-bar');\n\n      var svg = chartElement.append('svg').attr('width', svgWidth).attr('height', svgHeight);\n\n      swimlaneGroup = svg.append('g').attr('class', 'swimlane').attr('transform', 'translate(' + margin.left + ',' + margin.top + ')');\n\n      modelChartGroup = svg.append('g').attr('class', 'model-chart').attr('transform', 'translate(' + margin.left + ',' + margin.top + ')');\n\n      lineChartGroup = svg.append('g').attr('class', 'line-chart').attr('transform', 'translate(' + margin.left + ',' + margin.top + ')');\n    }\n\n    function drawLineChart() {\n      var data = scope.chartData.line;\n\n      lineChartXScale = lineChartXScale.domain(_d2.default.extent(data, function (d) {\n        return d.date;\n      }));\n\n      // Get the scaled date format to use for x axis tick labels.\n      var timeBuckets = new _time_buckets.TimeBuckets();\n      timeBuckets.setInterval('auto');\n      if (data.length > 0) {\n        var xDomain = lineChartXScale.domain();\n        var bounds = { min: (0, _moment2.default)(xDomain[0]), max: (0, _moment2.default)(xDomain[1]) };\n        timeBuckets.setBounds(bounds);\n      }\n      var xAxisTickFormat = timeBuckets.getScaledDateFormat();\n\n      chartLimits.max = _d2.default.max(data, function (d) {\n        return d.value;\n      });\n      chartLimits.min = _d2.default.min(data, function (d) {\n        return d.value;\n      });\n\n      // add padding of 10% of the difference between max and min\n      // to the upper and lower ends of the y-axis\n      var padding = (chartLimits.max - chartLimits.min) * 0.1;\n      chartLimits.max += padding;\n      chartLimits.min -= padding;\n\n      lineChartYScale = lineChartYScale.domain([chartLimits.min, chartLimits.max]);\n\n      var xAxis = _d2.default.svg.axis().scale(lineChartXScale).orient('bottom').innerTickSize(-lineChartHeight).outerTickSize(0).tickPadding(10).ticks((0, _chart_utils.numTicksForDateFormat)(vizWidth, xAxisTickFormat)).tickFormat(function (d) {\n        return (0, _moment2.default)(d).format(xAxisTickFormat);\n      });\n      var yAxis = _d2.default.svg.axis().scale(lineChartYScale).orient('left').innerTickSize(-vizWidth).outerTickSize(0).tickPadding(10);\n\n      if (scope.chartData.fieldFormat !== undefined) {\n        yAxis.tickFormat(function (d) {\n          return scope.chartData.fieldFormat.convert(d, 'text');\n        });\n      }\n\n      // Add border round plot area.\n      lineChartGroup.append('rect').attr('x', 0).attr('y', 0).attr('height', lineChartHeight).attr('width', vizWidth).style('stroke', '#cccccc').style('fill', 'none').style('stroke-width', 1);\n\n      drawLineChartAxes(xAxis, yAxis);\n      drawLineChartPaths(data);\n      (0, _chart_utils.drawLineChartDots)(data, lineChartGroup, lineChartValuesLine);\n    }\n\n    function drawLineChartAxes(xAxis, yAxis) {\n\n      var axes = lineChartGroup.append('g');\n\n      axes.append('g').attr('class', 'x axis').attr('transform', 'translate(0,' + lineChartHeight + ')').call(xAxis);\n\n      axes.append('g').attr('class', 'y axis').call(yAxis);\n    }\n\n    function drawLineChartPaths(data) {\n      lineChartGroup.append('path').attr('class', 'values-line').attr('d', lineChartValuesLine(data));\n    }\n\n    function drawResults() {\n      var model = scope.chartData.model;\n\n      drawModelPaths(model);\n      drawSwimlane(vizWidth, lineChartHeight);\n      updateProgressBar();\n    }\n\n    function drawModelPaths(model) {\n      modelChartGroup.selectAll('*').remove();\n      modelChartGroup.append('path').attr('class', 'area bounds').attr('d', lineChartBoundedArea(model));\n    }\n\n    function drawSwimlane(swlWidth, swlHeight) {\n      var data = scope.chartData.swimlane;\n\n      var cellWidth = 0;\n      if (data.length > 0) {\n        cellWidth = lineChartXScale(data[0].time + scope.chartData.swimlaneInterval) - lineChartXScale(data[0].time);\n      }\n\n      _d2.default.time.scale().range([0, swlWidth]).domain(_d2.default.extent(data, function (d) {\n        return d.date;\n      }));\n\n      _d2.default.scale.linear().range([swlHeight, 0]).domain([0, swlHeight]);\n\n      // Set up the color scale to use for indicating score.\n      var color = _d2.default.scale.threshold().domain([3, 25, 50, 75, 100]).range(['#d2e9f7', '#8bc8fb', '#ffdd00', '#ff7e00', '#fe5050']);\n\n      swimlaneGroup.select('.swimlane-cells').remove();\n\n      var cells = swimlaneGroup.append('g').attr('class', 'swimlane-cells').selectAll('cells').data(data);\n\n      cells.enter().append('rect').attr('x', function (d) {\n        return lineChartXScale(d.date);\n      }).attr('y', 0).attr('rx', 0).attr('ry', 0).attr('class', function (d) {\n        return d.value > 0 ? 'swimlane-cell' : 'swimlane-cell-hidden';\n      }).attr('width', cellWidth).attr('height', swlHeight).style('fill', function (d) {\n        return color(d.value);\n      });\n    }\n\n    function updateProgressBar() {\n      var pcnt = scope.chartData.percentComplete < 100 ? scope.chartData.percentComplete : 0;\n      $progressBar.css('width', pcnt + '%');\n    }\n  }\n\n  return {\n    scope: {\n      chartData: '=',\n      chartHeight: '=',\n      chartTicksMargin: '='\n    },\n    link: link\n  };\n});",null]}