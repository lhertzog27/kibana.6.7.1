{"remainingRequest":"/home/anthony/git_workspaces/kibana/node_modules/thread-loader/dist/cjs.js??ref--10-1!/home/anthony/git_workspaces/kibana/node_modules/ts-loader/index.js??ref--10-2!/home/anthony/git_workspaces/kibana/x-pack/plugins/beats_management/public/containers/beats.ts","dependencies":[{"path":"/home/anthony/git_workspaces/kibana/x-pack/plugins/beats_management/public/containers/beats.ts","mtime":1567631711881},{"path":"/home/anthony/git_workspaces/kibana/node_modules/cache-loader/dist/cjs.js","mtime":1567666236302},{"path":"/home/anthony/git_workspaces/kibana/node_modules/thread-loader/dist/cjs.js","mtime":1567666239443},{"path":"/home/anthony/git_workspaces/kibana/node_modules/ts-loader/index.js","mtime":1567666229769}],"contextDependencies":[],"result":["import * as tslib_1 from \"tslib\";\n/*\n * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n * or more contributor license agreements. Licensed under the Elastic License;\n * you may not use this file except in compliance with the Elastic License.\n */\nimport { Container } from 'unstated';\nvar BeatsContainer = /** @class */ (function (_super) {\n    tslib_1.__extends(BeatsContainer, _super);\n    function BeatsContainer(libs) {\n        var _this = _super.call(this) || this;\n        _this.libs = libs;\n        _this.getBeatWithToken = function (token) { return tslib_1.__awaiter(_this, void 0, void 0, function () {\n            var beat;\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.libs.beats.getBeatWithToken(token)];\n                    case 1:\n                        beat = _a.sent();\n                        if (beat) {\n                            this.setState({\n                                list: tslib_1.__spread([beat], this.state.list),\n                            });\n                            return [2 /*return*/, beat];\n                        }\n                        return [2 /*return*/, null];\n                }\n            });\n        }); };\n        _this.reload = function (kuery) { return tslib_1.__awaiter(_this, void 0, void 0, function () {\n            var beats;\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (kuery) {\n                            this.query = kuery;\n                        }\n                        else {\n                            this.query = undefined;\n                        }\n                        return [4 /*yield*/, this.libs.beats.getAll(this.query)];\n                    case 1:\n                        beats = _a.sent();\n                        this.setState({\n                            list: beats,\n                        });\n                        return [2 /*return*/];\n                }\n            });\n        }); };\n        _this.deactivate = function (beats) { return tslib_1.__awaiter(_this, void 0, void 0, function () {\n            var e_1, _a, beats_1, beats_1_1, beat, e_1_1;\n            var _this = this;\n            return tslib_1.__generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        _b.trys.push([0, 5, 6, 7]);\n                        beats_1 = tslib_1.__values(beats), beats_1_1 = beats_1.next();\n                        _b.label = 1;\n                    case 1:\n                        if (!!beats_1_1.done) return [3 /*break*/, 4];\n                        beat = beats_1_1.value;\n                        return [4 /*yield*/, this.libs.beats.update(beat.id, { active: false })];\n                    case 2:\n                        _b.sent();\n                        _b.label = 3;\n                    case 3:\n                        beats_1_1 = beats_1.next();\n                        return [3 /*break*/, 1];\n                    case 4: return [3 /*break*/, 7];\n                    case 5:\n                        e_1_1 = _b.sent();\n                        e_1 = { error: e_1_1 };\n                        return [3 /*break*/, 7];\n                    case 6:\n                        try {\n                            if (beats_1_1 && !beats_1_1.done && (_a = beats_1.return)) _a.call(beats_1);\n                        }\n                        finally { if (e_1) throw e_1.error; }\n                        return [7 /*endfinally*/];\n                    case 7:\n                        // because the compile code above has a very minor race condition, we wait,\n                        // the max race condition time is really 10ms but doing 100 to be safe\n                        setTimeout(function () { return tslib_1.__awaiter(_this, void 0, void 0, function () {\n                            return tslib_1.__generator(this, function (_a) {\n                                switch (_a.label) {\n                                    case 0: return [4 /*yield*/, this.reload(this.query)];\n                                    case 1:\n                                        _a.sent();\n                                        return [2 /*return*/];\n                                }\n                            });\n                        }); }, 100);\n                        return [2 /*return*/];\n                }\n            });\n        }); };\n        _this.toggleTagAssignment = function (tagId, beats) { return tslib_1.__awaiter(_this, void 0, void 0, function () {\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!beats.some(function (beat) { return beat.tags !== undefined && beat.tags.some(function (id) { return id === tagId; }); })) return [3 /*break*/, 2];\n                        return [4 /*yield*/, this.removeTagsFromBeats(beats, tagId)];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/, 'removed'];\n                    case 2: return [4 /*yield*/, this.assignTagsToBeats(beats, tagId)];\n                    case 3:\n                        _a.sent();\n                        return [2 /*return*/, 'added'];\n                }\n            });\n        }); };\n        _this.removeTagsFromBeats = function (beats, tagId) { return tslib_1.__awaiter(_this, void 0, void 0, function () {\n            var assignments;\n            var _this = this;\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!beats.length) {\n                            return [2 /*return*/, false];\n                        }\n                        assignments = createBeatTagAssignments(beats, tagId);\n                        return [4 /*yield*/, this.libs.beats.removeTagsFromBeats(assignments)];\n                    case 1:\n                        _a.sent();\n                        // ES responds incorrectly when we call too soon\n                        setTimeout(function () { return tslib_1.__awaiter(_this, void 0, void 0, function () {\n                            return tslib_1.__generator(this, function (_a) {\n                                switch (_a.label) {\n                                    case 0: return [4 /*yield*/, this.reload(this.query)];\n                                    case 1:\n                                        _a.sent();\n                                        return [2 /*return*/];\n                                }\n                            });\n                        }); }, 150);\n                        return [2 /*return*/];\n                }\n            });\n        }); };\n        _this.assignTagsToBeats = function (beats, tagId) { return tslib_1.__awaiter(_this, void 0, void 0, function () {\n            var assignments;\n            var _this = this;\n            return tslib_1.__generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!beats.length) {\n                            return [2 /*return*/, false];\n                        }\n                        assignments = createBeatTagAssignments(beats, tagId);\n                        return [4 /*yield*/, this.libs.beats.assignTagsToBeats(assignments)];\n                    case 1:\n                        _a.sent();\n                        // ES responds incorrectly when we call too soon\n                        setTimeout(function () { return tslib_1.__awaiter(_this, void 0, void 0, function () {\n                            return tslib_1.__generator(this, function (_a) {\n                                switch (_a.label) {\n                                    case 0: return [4 /*yield*/, this.reload(this.query)];\n                                    case 1:\n                                        _a.sent();\n                                        return [2 /*return*/];\n                                }\n                            });\n                        }); }, 150);\n                        return [2 /*return*/];\n                }\n            });\n        }); };\n        _this.state = {\n            list: [],\n        };\n        return _this;\n    }\n    return BeatsContainer;\n}(Container));\nexport { BeatsContainer };\nfunction createBeatTagAssignments(beats, tagId) {\n    if (typeof beats[0] === 'string') {\n        return beats.map(function (id) { return ({ beatId: id, tag: tagId }); });\n    }\n    else {\n        return beats.map(function (_a) {\n            var id = _a.id;\n            return ({ beatId: id, tag: tagId });\n        });\n    }\n}\n",{"version":3,"file":"/home/anthony/git_workspaces/kibana/x-pack/plugins/beats_management/public/containers/beats.ts","sourceRoot":"","sources":["/home/anthony/git_workspaces/kibana/x-pack/plugins/beats_management/public/containers/beats.ts"],"names":[],"mappings":"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","sourcesContent":["/*\n * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n * or more contributor license agreements. Licensed under the Elastic License;\n * you may not use this file except in compliance with the Elastic License.\n */\nimport { Container } from 'unstated';\nimport { CMBeat } from './../../common/domain_types';\nimport { BeatsTagAssignment } from './../../server/lib/adapters/beats/adapter_types';\nimport { FrontendLibs } from './../lib/types';\n\ninterface ContainerState {\n  list: CMBeat[];\n}\n\nexport class BeatsContainer extends Container<ContainerState> {\n  private query?: string;\n  constructor(private readonly libs: FrontendLibs) {\n    super();\n    this.state = {\n      list: [],\n    };\n  }\n\n  public getBeatWithToken = async (token: string) => {\n    const beat = await this.libs.beats.getBeatWithToken(token);\n\n    if (beat) {\n      this.setState({\n        list: [beat as CMBeat, ...this.state.list],\n      });\n      return beat as CMBeat;\n    }\n    return null;\n  };\n\n  public reload = async (kuery?: string) => {\n    if (kuery) {\n      this.query = kuery;\n    } else {\n      this.query = undefined;\n    }\n    const beats = await this.libs.beats.getAll(this.query);\n\n    this.setState({\n      list: beats,\n    });\n  };\n\n  public deactivate = async (beats: CMBeat[]) => {\n    for (const beat of beats) {\n      await this.libs.beats.update(beat.id, { active: false });\n    }\n\n    // because the compile code above has a very minor race condition, we wait,\n    // the max race condition time is really 10ms but doing 100 to be safe\n    setTimeout(async () => {\n      await this.reload(this.query);\n    }, 100);\n  };\n\n  public toggleTagAssignment = async (tagId: string, beats: CMBeat[]) => {\n    if (beats.some(beat => beat.tags !== undefined && beat.tags.some(id => id === tagId))) {\n      await this.removeTagsFromBeats(beats, tagId);\n      return 'removed';\n    }\n    await this.assignTagsToBeats(beats, tagId);\n    return 'added';\n  };\n\n  public removeTagsFromBeats = async (beats: CMBeat[] | string[], tagId: string) => {\n    if (!beats.length) {\n      return false;\n    }\n    const assignments = createBeatTagAssignments(beats, tagId);\n    await this.libs.beats.removeTagsFromBeats(assignments);\n    // ES responds incorrectly when we call too soon\n    setTimeout(async () => {\n      await this.reload(this.query);\n    }, 150);\n  };\n\n  public assignTagsToBeats = async (beats: CMBeat[] | string[], tagId: string) => {\n    if (!beats.length) {\n      return false;\n    }\n    const assignments = createBeatTagAssignments(beats, tagId);\n    await this.libs.beats.assignTagsToBeats(assignments);\n    // ES responds incorrectly when we call too soon\n    setTimeout(async () => {\n      await this.reload(this.query);\n    }, 150);\n  };\n}\n\nfunction createBeatTagAssignments(beats: CMBeat[] | string[], tagId: string): BeatsTagAssignment[] {\n  if (typeof beats[0] === 'string') {\n    return (beats as string[]).map(id => ({ beatId: id, tag: tagId }));\n  } else {\n    return (beats as CMBeat[]).map(({ id }) => ({ beatId: id, tag: tagId }));\n  }\n}\n"]}]}