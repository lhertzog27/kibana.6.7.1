"use strict";
/*
 * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one
 * or more contributor license agreements. Licensed under the Elastic License;
 * you may not use this file except in compliance with the Elastic License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
const create_query_1 = require("./create_query");
async function calculateCardinalityOfNodeField(search, nodeField, options) {
    const { sourceConfiguration } = options;
    const body = {
        aggs: {
            nodeCount: {
                cardinality: { field: nodeField },
            },
        },
        query: create_query_1.createQuery(options),
        size: 0,
    };
    const resp = await search({
        allow_no_indices: true,
        body,
        ignore_unavailable: true,
        index: `${sourceConfiguration.logAlias},${sourceConfiguration.metricAlias}`,
    });
    if (resp.aggregations) {
        return resp.aggregations.nodeCount.value;
    }
    return 0;
}
exports.calculateCardinalityOfNodeField = calculateCardinalityOfNodeField;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiL2hvbWUvYW50aG9ueS9naXRfd29ya3NwYWNlcy9raWJhbmEveC1wYWNrL3BsdWdpbnMvaW5mcmEvc2VydmVyL2xpYi9hZGFwdGVycy9ub2Rlcy9saWIvY2FsY3VsYXRlX2NhcmRpbmFsaXR5LnRzIiwic291cmNlcyI6WyIvaG9tZS9hbnRob255L2dpdF93b3Jrc3BhY2VzL2tpYmFuYS94LXBhY2svcGx1Z2lucy9pbmZyYS9zZXJ2ZXIvbGliL2FkYXB0ZXJzL25vZGVzL2xpYi9jYWxjdWxhdGVfY2FyZGluYWxpdHkudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBOzs7O0dBSUc7O0FBSUgsaURBQTZDO0FBY3RDLEtBQUssVUFBVSwrQkFBK0IsQ0FDbkQsTUFBK0YsRUFDL0YsU0FBaUIsRUFDakIsT0FBZ0M7SUFFaEMsTUFBTSxFQUFFLG1CQUFtQixFQUFFLEdBQTRCLE9BQU8sQ0FBQztJQUNqRSxNQUFNLElBQUksR0FBNkI7UUFDckMsSUFBSSxFQUFFO1lBQ0osU0FBUyxFQUFFO2dCQUNULFdBQVcsRUFBRSxFQUFFLEtBQUssRUFBRSxTQUFTLEVBQUU7YUFDbEM7U0FDRjtRQUNELEtBQUssRUFBRSwwQkFBVyxDQUFDLE9BQU8sQ0FBQztRQUMzQixJQUFJLEVBQUUsQ0FBQztLQUNSLENBQUM7SUFFRixNQUFNLElBQUksR0FBRyxNQUFNLE1BQU0sQ0FBeUI7UUFDaEQsZ0JBQWdCLEVBQUUsSUFBSTtRQUN0QixJQUFJO1FBQ0osa0JBQWtCLEVBQUUsSUFBSTtRQUN4QixLQUFLLEVBQUUsR0FBRyxtQkFBbUIsQ0FBQyxRQUFRLElBQUksbUJBQW1CLENBQUMsV0FBVyxFQUFFO0tBQzVFLENBQUMsQ0FBQztJQUVILElBQUksSUFBSSxDQUFDLFlBQVksRUFBRTtRQUNyQixPQUFPLElBQUksQ0FBQyxZQUFZLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQztLQUMxQztJQUVELE9BQU8sQ0FBQyxDQUFDO0FBQ1gsQ0FBQztBQTVCRCwwRUE0QkMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogQ29weXJpZ2h0IEVsYXN0aWNzZWFyY2ggQi5WLiBhbmQvb3IgbGljZW5zZWQgdG8gRWxhc3RpY3NlYXJjaCBCLlYuIHVuZGVyIG9uZVxuICogb3IgbW9yZSBjb250cmlidXRvciBsaWNlbnNlIGFncmVlbWVudHMuIExpY2Vuc2VkIHVuZGVyIHRoZSBFbGFzdGljIExpY2Vuc2U7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIEVsYXN0aWMgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQgeyBJbmZyYURhdGFiYXNlU2VhcmNoUmVzcG9uc2UgfSBmcm9tICcuLi8uLi9mcmFtZXdvcmsnO1xuaW1wb3J0IHsgSW5mcmFFU1F1ZXJ5LCBJbmZyYU5vZGVSZXF1ZXN0T3B0aW9ucyB9IGZyb20gJy4uL2FkYXB0ZXJfdHlwZXMnO1xuaW1wb3J0IHsgY3JlYXRlUXVlcnkgfSBmcm9tICcuL2NyZWF0ZV9xdWVyeSc7XG5cbmludGVyZmFjZSBDYXJkaW5hbGl0eU9mRmllbGRQYXJhbXMge1xuICBzaXplOiBudW1iZXI7XG4gIHF1ZXJ5OiBJbmZyYUVTUXVlcnk7XG4gIGFnZ3M6IHtcbiAgICBub2RlQ291bnQ6IHsgY2FyZGluYWxpdHk6IHsgZmllbGQ6IHN0cmluZyB9IH07XG4gIH07XG59XG5cbmludGVyZmFjZSBDYXJkaW5hbGl0eUFnZ3JlZ2F0aW9uIHtcbiAgbm9kZUNvdW50OiB7IHZhbHVlOiBudW1iZXIgfTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNhbGN1bGF0ZUNhcmRpbmFsaXR5T2ZOb2RlRmllbGQoXG4gIHNlYXJjaDogPEFnZ3JlZ2F0aW9uPihvcHRpb25zOiBvYmplY3QpID0+IFByb21pc2U8SW5mcmFEYXRhYmFzZVNlYXJjaFJlc3BvbnNlPHt9LCBBZ2dyZWdhdGlvbj4+LFxuICBub2RlRmllbGQ6IHN0cmluZyxcbiAgb3B0aW9uczogSW5mcmFOb2RlUmVxdWVzdE9wdGlvbnNcbik6IFByb21pc2U8bnVtYmVyPiB7XG4gIGNvbnN0IHsgc291cmNlQ29uZmlndXJhdGlvbiB9OiBJbmZyYU5vZGVSZXF1ZXN0T3B0aW9ucyA9IG9wdGlvbnM7XG4gIGNvbnN0IGJvZHk6IENhcmRpbmFsaXR5T2ZGaWVsZFBhcmFtcyA9IHtcbiAgICBhZ2dzOiB7XG4gICAgICBub2RlQ291bnQ6IHtcbiAgICAgICAgY2FyZGluYWxpdHk6IHsgZmllbGQ6IG5vZGVGaWVsZCB9LFxuICAgICAgfSxcbiAgICB9LFxuICAgIHF1ZXJ5OiBjcmVhdGVRdWVyeShvcHRpb25zKSxcbiAgICBzaXplOiAwLFxuICB9O1xuXG4gIGNvbnN0IHJlc3AgPSBhd2FpdCBzZWFyY2g8Q2FyZGluYWxpdHlBZ2dyZWdhdGlvbj4oe1xuICAgIGFsbG93X25vX2luZGljZXM6IHRydWUsXG4gICAgYm9keSxcbiAgICBpZ25vcmVfdW5hdmFpbGFibGU6IHRydWUsXG4gICAgaW5kZXg6IGAke3NvdXJjZUNvbmZpZ3VyYXRpb24ubG9nQWxpYXN9LCR7c291cmNlQ29uZmlndXJhdGlvbi5tZXRyaWNBbGlhc31gLFxuICB9KTtcblxuICBpZiAocmVzcC5hZ2dyZWdhdGlvbnMpIHtcbiAgICByZXR1cm4gcmVzcC5hZ2dyZWdhdGlvbnMubm9kZUNvdW50LnZhbHVlO1xuICB9XG5cbiAgcmV0dXJuIDA7XG59XG4iXX0=