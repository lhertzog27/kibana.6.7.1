"use strict";
/*
 * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one
 * or more contributor license agreements. Licensed under the Elastic License;
 * you may not use this file except in compliance with the Elastic License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
const usage_collector_1 = require("../../usage/usage_collector");
const serialized_query_1 = require("../../utils/serialized_query");
exports.createLogEntriesResolvers = (libs) => ({
    InfraSource: {
        async logEntriesAround(source, args, { req }) {
            const countBefore = args.countBefore || 0;
            const countAfter = args.countAfter || 0;
            const { entriesBefore, entriesAfter } = await libs.logEntries.getLogEntriesAround(req, source.id, args.key, countBefore + 1, countAfter + 1, serialized_query_1.parseFilterQuery(args.filterQuery), args.highlightQuery || undefined);
            const hasMoreBefore = entriesBefore.length > countBefore;
            const hasMoreAfter = entriesAfter.length > countAfter;
            const entries = [
                ...(hasMoreBefore ? entriesBefore.slice(1) : entriesBefore),
                ...(hasMoreAfter ? entriesAfter.slice(0, -1) : entriesAfter),
            ];
            return {
                start: entries.length > 0 ? entries[0].key : null,
                end: entries.length > 0 ? entries[entries.length - 1].key : null,
                hasMoreBefore,
                hasMoreAfter,
                filterQuery: args.filterQuery,
                highlightQuery: args.highlightQuery,
                entries,
            };
        },
        async logEntriesBetween(source, args, { req }) {
            const entries = await libs.logEntries.getLogEntriesBetween(req, source.id, args.startKey, args.endKey, serialized_query_1.parseFilterQuery(args.filterQuery), args.highlightQuery || undefined);
            return {
                start: entries.length > 0 ? entries[0].key : null,
                end: entries.length > 0 ? entries[entries.length - 1].key : null,
                hasMoreBefore: true,
                hasMoreAfter: true,
                filterQuery: args.filterQuery,
                highlightQuery: args.highlightQuery,
                entries,
            };
        },
        async logSummaryBetween(source, args, { req }) {
            usage_collector_1.UsageCollector.countLogs();
            const buckets = await libs.logEntries.getLogSummaryBucketsBetween(req, source.id, args.start, args.end, args.bucketSize, serialized_query_1.parseFilterQuery(args.filterQuery));
            return {
                start: buckets.length > 0 ? buckets[0].start : null,
                end: buckets.length > 0 ? buckets[buckets.length - 1].end : null,
                buckets,
            };
        },
        async logItem(source, args, { req }) {
            return await libs.logEntries.getLogItem(req, args.id, source.configuration);
        },
    },
    InfraLogMessageSegment: {
        __resolveType: (messageSegment) => {
            if (isConstantSegment(messageSegment)) {
                return 'InfraLogMessageConstantSegment';
            }
            if (isFieldSegment(messageSegment)) {
                return 'InfraLogMessageFieldSegment';
            }
            return null;
        },
    },
});
const isConstantSegment = (segment) => 'constant' in segment;
const isFieldSegment = (segment) => 'field' in segment && 'value' in segment && 'highlights' in segment;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiL2hvbWUvYW50aG9ueS9naXRfd29ya3NwYWNlcy9raWJhbmEveC1wYWNrL3BsdWdpbnMvaW5mcmEvc2VydmVyL2dyYXBocWwvbG9nX2VudHJpZXMvcmVzb2x2ZXJzLnRzIiwic291cmNlcyI6WyIvaG9tZS9hbnRob255L2dpdF93b3Jrc3BhY2VzL2tpYmFuYS94LXBhY2svcGx1Z2lucy9pbmZyYS9zZXJ2ZXIvZ3JhcGhxbC9sb2dfZW50cmllcy9yZXNvbHZlcnMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBOzs7O0dBSUc7O0FBU0gsaUVBQTZEO0FBQzdELG1FQUFnRTtBQXdCbkQsUUFBQSx5QkFBeUIsR0FBRyxDQUFDLElBRXpDLEVBWUMsRUFBRSxDQUFDLENBQUM7SUFDSixXQUFXLEVBQUU7UUFDWCxLQUFLLENBQUMsZ0JBQWdCLENBQUMsTUFBTSxFQUFFLElBQUksRUFBRSxFQUFFLEdBQUcsRUFBRTtZQUMxQyxNQUFNLFdBQVcsR0FBRyxJQUFJLENBQUMsV0FBVyxJQUFJLENBQUMsQ0FBQztZQUMxQyxNQUFNLFVBQVUsR0FBRyxJQUFJLENBQUMsVUFBVSxJQUFJLENBQUMsQ0FBQztZQUV4QyxNQUFNLEVBQUUsYUFBYSxFQUFFLFlBQVksRUFBRSxHQUFHLE1BQU0sSUFBSSxDQUFDLFVBQVUsQ0FBQyxtQkFBbUIsQ0FDL0UsR0FBRyxFQUNILE1BQU0sQ0FBQyxFQUFFLEVBQ1QsSUFBSSxDQUFDLEdBQUcsRUFDUixXQUFXLEdBQUcsQ0FBQyxFQUNmLFVBQVUsR0FBRyxDQUFDLEVBQ2QsbUNBQWdCLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxFQUNsQyxJQUFJLENBQUMsY0FBYyxJQUFJLFNBQVMsQ0FDakMsQ0FBQztZQUVGLE1BQU0sYUFBYSxHQUFHLGFBQWEsQ0FBQyxNQUFNLEdBQUcsV0FBVyxDQUFDO1lBQ3pELE1BQU0sWUFBWSxHQUFHLFlBQVksQ0FBQyxNQUFNLEdBQUcsVUFBVSxDQUFDO1lBRXRELE1BQU0sT0FBTyxHQUFHO2dCQUNkLEdB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LEVBQUUsSUFBSSxFQUFFLEVBQUUsR0FBRyxFQUFFO1lBQ2pDLE9BQU8sTUFBTSxJQUFJLENBQUMsVUFBVSxDQUFDLFVBQVUsQ0FBQyxHQUFHLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxNQUFNLENBQUMsYUFBYSxDQUFDLENBQUM7UUFDOUUsQ0FBQztLQUNGO0lBQ0Qsc0JBQXNCLEVBQUU7UUFDdEIsYUFBYSxFQUFFLENBQUMsY0FBc0MsRUFBRSxFQUFFO1lBQ3hELElBQUksaUJBQWlCLENBQUMsY0FBYyxDQUFDLEVBQUU7Z0JBQ3JDLE9BQU8sZ0NBQWdDLENBQUM7YUFDekM7WUFFRCxJQUFJLGNBQWMsQ0FBQyxjQUFjLENBQUMsRUFBRTtnQkFDbEMsT0FBTyw2QkFBNkIsQ0FBQzthQUN0QztZQUVELE9BQU8sSUFBSSxDQUFDO1FBQ2QsQ0FBQztLQUNGO0NBQ0YsQ0FBQyxDQUFDO0FBRUgsTUFBTSxpQkFBaUIsR0FBRyxDQUN4QixPQUErQixFQUNZLEVBQUUsQ0FBQyxVQUFVLElBQUksT0FBTyxDQUFDO0FBRXRFLE1BQU0sY0FBYyxHQUFHLENBQUMsT0FBK0IsRUFBMEMsRUFBRSxDQUNqRyxPQUFPLElBQUksT0FBTyxJQUFJLE9BQU8sSUFBSSxPQUFPLElBQUksWUFBWSxJQUFJLE9BQU8sQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBDb3B5cmlnaHQgRWxhc3RpY3NlYXJjaCBCLlYuIGFuZC9vciBsaWNlbnNlZCB0byBFbGFzdGljc2VhcmNoIEIuVi4gdW5kZXIgb25lXG4gKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxpY2Vuc2UgYWdyZWVtZW50cy4gTGljZW5zZWQgdW5kZXIgdGhlIEVsYXN0aWMgTGljZW5zZTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgRWxhc3RpYyBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7XG4gIEluZnJhTG9nTWVzc2FnZUNvbnN0YW50U2VnbWVudCxcbiAgSW5mcmFMb2dNZXNzYWdlRmllbGRTZWdtZW50LFxuICBJbmZyYUxvZ01lc3NhZ2VTZWdtZW50LFxuICBJbmZyYVNvdXJjZVJlc29sdmVycyxcbn0gZnJvbSAnLi4vLi4vZ3JhcGhxbC90eXBlcyc7XG5pbXBvcnQgeyBJbmZyYUxvZ0VudHJpZXNEb21haW4gfSBmcm9tICcuLi8uLi9saWIvZG9tYWlucy9sb2dfZW50cmllc19kb21haW4nO1xuaW1wb3J0IHsgVXNhZ2VDb2xsZWN0b3IgfSBmcm9tICcuLi8uLi91c2FnZS91c2FnZV9jb2xsZWN0b3InO1xuaW1wb3J0IHsgcGFyc2VGaWx0ZXJRdWVyeSB9IGZyb20gJy4uLy4uL3V0aWxzL3NlcmlhbGl6ZWRfcXVlcnknO1xuaW1wb3J0IHsgQ2hpbGRSZXNvbHZlck9mLCBJbmZyYVJlc29sdmVyT2YgfSBmcm9tICcuLi8uLi91dGlscy90eXBlZF9yZXNvbHZlcnMnO1xuaW1wb3J0IHsgUXVlcnlTb3VyY2VSZXNvbHZlciB9IGZyb20gJy4uL3NvdXJjZXMvcmVzb2x2ZXJzJztcblxuZXhwb3J0IHR5cGUgSW5mcmFTb3VyY2VMb2dFbnRyaWVzQXJvdW5kUmVzb2x2ZXIgPSBDaGlsZFJlc29sdmVyT2Y8XG4gIEluZnJhUmVzb2x2ZXJPZjxJbmZyYVNvdXJjZVJlc29sdmVycy5Mb2dFbnRyaWVzQXJvdW5kUmVzb2x2ZXI+LFxuICBRdWVyeVNvdXJjZVJlc29sdmVyXG4+O1xuXG5leHBvcnQgdHlwZSBJbmZyYVNvdXJjZUxvZ0VudHJpZXNCZXR3ZWVuUmVzb2x2ZXIgPSBDaGlsZFJlc29sdmVyT2Y8XG4gIEluZnJhUmVzb2x2ZXJPZjxJbmZyYVNvdXJjZVJlc29sdmVycy5Mb2dFbnRyaWVzQmV0d2VlblJlc29sdmVyPixcbiAgUXVlcnlTb3VyY2VSZXNvbHZlclxuPjtcblxuZXhwb3J0IHR5cGUgSW5mcmFTb3VyY2VMb2dTdW1tYXJ5QmV0d2VlblJlc29sdmVyID0gQ2hpbGRSZXNvbHZlck9mPFxuICBJbmZyYVJlc29sdmVyT2Y8SW5mcmFTb3VyY2VSZXNvbHZlcnMuTG9nU3VtbWFyeUJldHdlZW5SZXNvbHZlcj4sXG4gIFF1ZXJ5U291cmNlUmVzb2x2ZXJcbj47XG5cbmV4cG9ydCB0eXBlIEluZnJhU291cmNlTG9nSXRlbSA9IENoaWxkUmVzb2x2ZXJPZjxcbiAgSW5mcmFSZXNvbHZlck9mPEluZnJhU291cmNlUmVzb2x2ZXJzLkxvZ0l0ZW1SZXNvbHZlcj4sXG4gIFF1ZXJ5U291cmNlUmVzb2x2ZXJcbj47XG5cbmV4cG9ydCBjb25zdCBjcmVhdGVMb2dFbnRyaWVzUmVzb2x2ZXJzID0gKGxpYnM6IHtcbiAgbG9nRW50cmllczogSW5mcmFMb2dFbnRyaWVzRG9tYWluO1xufSk6IHtcbiAgSW5mcmFTb3VyY2U6IHtcbiAgICBsb2dFbnRyaWVzQXJvdW5kOiBJbmZyYVNvdXJjZUxvZ0VudHJpZXNBcm91bmRSZXNvbHZlcjtcbiAgICBsb2dFbnRyaWVzQmV0d2VlbjogSW5mcmFTb3VyY2VMb2dFbnRyaWVzQmV0d2VlblJlc29sdmVyO1xuICAgIGxvZ1N1bW1hcnlCZXR3ZWVuOiBJbmZyYVNvdXJjZUxvZ1N1bW1hcnlCZXR3ZWVuUmVzb2x2ZXI7XG4gICAgbG9nSXRlbTogSW5mcmFTb3VyY2VMb2dJdGVtO1xuICB9O1xuICBJbmZyYUxvZ01lc3NhZ2VTZWdtZW50OiB7XG4gICAgX19yZXNvbHZlVHlwZShcbiAgICAgIG1lc3NhZ2VTZWdtZW50OiBJbmZyYUxvZ01lc3NhZ2VTZWdtZW50XG4gICAgKTogJ0luZnJhTG9nTWVzc2FnZUZpZWxkU2VnbWVudCcgfCAnSW5mcmFMb2dNZXNzYWdlQ29uc3RhbnRTZWdtZW50JyB8IG51bGw7XG4gIH07XG59ID0+ICh7XG4gIEluZnJhU291cmNlOiB7XG4gICAgYXN5bmMgbG9nRW50cmllc0Fyb3VuZChzb3VyY2UsIGFyZ3MsIHsgcmVxIH0pIHtcbiAgICAgIGNvbnN0IGNvdW50QmVmb3JlID0gYXJncy5jb3VudEJlZm9yZSB8fCAwO1xuICAgICAgY29uc3QgY291bnRBZnRlciA9IGFyZ3MuY291bnRBZnRlciB8fCAwO1xuXG4gICAgICBjb25zdCB7IGVudHJpZXNCZWZvcmUsIGVudHJpZXNBZnRlciB9ID0gYXdhaXQgbGlicy5sb2dFbnRyaWVzLmdldExvZ0VudHJpZXNBcm91bmQoXG4gICAgICAgIHJlcSxcbiAgICAgICAgc291cmNlLmlkLFxuICAgICAgICBhcmdzLmtleSxcbiAgICAgICAgY291bnRCZWZvcmUgKyAxLFxuICAgICAgICBjb3VudEFmdGVyICsgMSxcbiAgICAgICAgcGFyc2VGaWx0ZXJRdWVyeShhcmdzLmZpbHRlclF1ZXJ5KSxcbiAgICAgICAgYXJncy5oaWdobGlnaHRRdWVyeSB8fCB1bmRlZmluZWRcbiAgICAgICk7XG5cbiAgICAgIGNvbnN0IGhhc01vcmVCZWZvcmUgPSBlbnRyaWVzQmVmb3JlLmxlbmd0aCA+IGNvdW50QmVmb3JlO1xuICAgICAgY29uc3QgaGFzTW9yZUFmdGVyID0gZW50cmllc0FmdGVyLmxlbmd0aCA+IGNvdW50QWZ0ZXI7XG5cbiAgICAgIGNvbnN0IGVudHJpZXMgPSBbXG4gICAgICAgIC4uLihoYXNNb3JlQmVmb3JlID8gZW50cmllc0JlZm9yZS5zbGljZSgxKSA6IGVudHJpZXNCZWZvcmUpLFxuICAgICAgICAuLi4oaGFzTW9yZUFmdGVyID8gZW50cmllc0FmdGVyLnNsaWNlKDAsIC0xKSA6IGVudHJpZXNBZnRlciksXG4gICAgICBdO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdGFydDogZW50cmllcy5sZW5ndGggPiAwID8gZW50cmllc1swXS5rZXkgOiBudWxsLFxuICAgICAgICBlbmQ6IGVudHJpZXMubGVuZ3RoID4gMCA/IGVudHJpZXNbZW50cmllcy5sZW5ndGggLSAxXS5rZXkgOiBudWxsLFxuICAgICAgICBoYXNNb3JlQmVmb3JlLFxuICAgICAgICBoYXNNb3JlQWZ0ZXIsXG4gICAgICAgIGZpbHRlclF1ZXJ5OiBhcmdzLmZpbHRlclF1ZXJ5LFxuICAgICAgICBoaWdobGlnaHRRdWVyeTogYXJncy5oaWdobGlnaHRRdWVyeSxcbiAgICAgICAgZW50cmllcyxcbiAgICAgIH07XG4gICAgfSxcbiAgICBhc3luYyBsb2dFbnRyaWVzQmV0d2Vlbihzb3VyY2UsIGFyZ3MsIHsgcmVxIH0pIHtcbiAgICAgIGNvbnN0IGVudHJpZXMgPSBhd2FpdCBsaWJzLmxvZ0VudHJpZXMuZ2V0TG9nRW50cmllc0JldHdlZW4oXG4gICAgICAgIHJlcSxcbiAgICAgICAgc291cmNlLmlkLFxuICAgICAgICBhcmdzLnN0YXJ0S2V5LFxuICAgICAgICBhcmdzLmVuZEtleSxcbiAgICAgICAgcGFyc2VGaWx0ZXJRdWVyeShhcmdzLmZpbHRlclF1ZXJ5KSxcbiAgICAgICAgYXJncy5oaWdobGlnaHRRdWVyeSB8fCB1bmRlZmluZWRcbiAgICAgICk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN0YXJ0OiBlbnRyaWVzLmxlbmd0aCA+IDAgPyBlbnRyaWVzWzBdLmtleSA6IG51bGwsXG4gICAgICAgIGVuZDogZW50cmllcy5sZW5ndGggPiAwID8gZW50cmllc1tlbnRyaWVzLmxlbmd0aCAtIDFdLmtleSA6IG51bGwsXG4gICAgICAgIGhhc01vcmVCZWZvcmU6IHRydWUsXG4gICAgICAgIGhhc01vcmVBZnRlcjogdHJ1ZSxcbiAgICAgICAgZmlsdGVyUXVlcnk6IGFyZ3MuZmlsdGVyUXVlcnksXG4gICAgICAgIGhpZ2hsaWdodFF1ZXJ5OiBhcmdzLmhpZ2hsaWdodFF1ZXJ5LFxuICAgICAgICBlbnRyaWVzLFxuICAgICAgfTtcbiAgICB9LFxuICAgIGFzeW5jIGxvZ1N1bW1hcnlCZXR3ZWVuKHNvdXJjZSwgYXJncywgeyByZXEgfSkge1xuICAgICAgVXNhZ2VDb2xsZWN0b3IuY291bnRMb2dzKCk7XG4gICAgICBjb25zdCBidWNrZXRzID0gYXdhaXQgbGlicy5sb2dFbnRyaWVzLmdldExvZ1N1bW1hcnlCdWNrZXRzQmV0d2VlbihcbiAgICAgICAgcmVxLFxuICAgICAgICBzb3VyY2UuaWQsXG4gICAgICAgIGFyZ3Muc3RhcnQsXG4gICAgICAgIGFyZ3MuZW5kLFxuICAgICAgICBhcmdzLmJ1Y2tldFNpemUsXG4gICAgICAgIHBhcnNlRmlsdGVyUXVlcnkoYXJncy5maWx0ZXJRdWVyeSlcbiAgICAgICk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN0YXJ0OiBidWNrZXRzLmxlbmd0aCA+IDAgPyBidWNrZXRzWzBdLnN0YXJ0IDogbnVsbCxcbiAgICAgICAgZW5kOiBidWNrZXRzLmxlbmd0aCA+IDAgPyBidWNrZXRzW2J1Y2tldHMubGVuZ3RoIC0gMV0uZW5kIDogbnVsbCxcbiAgICAgICAgYnVja2V0cyxcbiAgICAgIH07XG4gICAgfSxcbiAgICBhc3luYyBsb2dJdGVtKHNvdXJjZSwgYXJncywgeyByZXEgfSkge1xuICAgICAgcmV0dXJuIGF3YWl0IGxpYnMubG9nRW50cmllcy5nZXRMb2dJdGVtKHJlcSwgYXJncy5pZCwgc291cmNlLmNvbmZpZ3VyYXRpb24pO1xuICAgIH0sXG4gIH0sXG4gIEluZnJhTG9nTWVzc2FnZVNlZ21lbnQ6IHtcbiAgICBfX3Jlc29sdmVUeXBlOiAobWVzc2FnZVNlZ21lbnQ6IEluZnJhTG9nTWVzc2FnZVNlZ21lbnQpID0+IHtcbiAgICAgIGlmIChpc0NvbnN0YW50U2VnbWVudChtZXNzYWdlU2VnbWVudCkpIHtcbiAgICAgICAgcmV0dXJuICdJbmZyYUxvZ01lc3NhZ2VDb25zdGFudFNlZ21lbnQnO1xuICAgICAgfVxuXG4gICAgICBpZiAoaXNGaWVsZFNlZ21lbnQobWVzc2FnZVNlZ21lbnQpKSB7XG4gICAgICAgIHJldHVybiAnSW5mcmFMb2dNZXNzYWdlRmllbGRTZWdtZW50JztcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfSxcbiAgfSxcbn0pO1xuXG5jb25zdCBpc0NvbnN0YW50U2VnbWVudCA9IChcbiAgc2VnbWVudDogSW5mcmFMb2dNZXNzYWdlU2VnbWVudFxuKTogc2VnbWVudCBpcyBJbmZyYUxvZ01lc3NhZ2VDb25zdGFudFNlZ21lbnQgPT4gJ2NvbnN0YW50JyBpbiBzZWdtZW50O1xuXG5jb25zdCBpc0ZpZWxkU2VnbWVudCA9IChzZWdtZW50OiBJbmZyYUxvZ01lc3NhZ2VTZWdtZW50KTogc2VnbWVudCBpcyBJbmZyYUxvZ01lc3NhZ2VGaWVsZFNlZ21lbnQgPT5cbiAgJ2ZpZWxkJyBpbiBzZWdtZW50ICYmICd2YWx1ZScgaW4gc2VnbWVudCAmJiAnaGlnaGxpZ2h0cycgaW4gc2VnbWVudDtcbiJdfQ==