"use strict";
/*
 * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one
 * or more contributor license agreements. Licensed under the Elastic License;
 * you may not use this file except in compliance with the Elastic License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
const lodash_1 = require("lodash");
const create_base_path_1 = require("../../lib/create_base_path");
const metric_aggregation_creators_1 = require("../../metric_aggregation_creators");
exports.metricBucketsProcessor = (options) => {
    return (doc) => {
        const result = lodash_1.cloneDeep(doc);
        const { metric, groupBy } = options.nodeOptions;
        const path = create_base_path_1.createBasePath(groupBy).concat(['timeseries', 'aggs']);
        const aggregationCreator = metric_aggregation_creators_1.metricAggregationCreators[metric.type];
        const aggs = aggregationCreator(options.nodeType);
        lodash_1.set(result, path, aggs);
        return result;
    };
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiL2hvbWUvYW50aG9ueS9naXRfd29ya3NwYWNlcy9raWJhbmEveC1wYWNrL3BsdWdpbnMvaW5mcmEvc2VydmVyL2xpYi9hZGFwdGVycy9ub2Rlcy9wcm9jZXNzb3JzL2xhc3QvbWV0cmljX2J1Y2tldHNfcHJvY2Vzc29yLnRzIiwic291cmNlcyI6WyIvaG9tZS9hbnRob255L2dpdF93b3Jrc3BhY2VzL2tpYmFuYS94LXBhY2svcGx1Z2lucy9pbmZyYS9zZXJ2ZXIvbGliL2FkYXB0ZXJzL25vZGVzL3Byb2Nlc3NvcnMvbGFzdC9tZXRyaWNfYnVja2V0c19wcm9jZXNzb3IudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBOzs7O0dBSUc7O0FBRUgsbUNBQXdDO0FBRXhDLGlFQUE0RDtBQUM1RCxtRkFBOEU7QUFFakUsUUFBQSxzQkFBc0IsR0FBRyxDQUFDLE9BQW9DLEVBQUUsRUFBRTtJQUM3RSxPQUFPLENBQUMsR0FBc0IsRUFBRSxFQUFFO1FBQ2hDLE1BQU0sTUFBTSxHQUFHLGtCQUFTLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDOUIsTUFBTSxFQUFFLE1BQU0sRUFBRSxPQUFPLEVBQUUsR0FBRyxPQUFPLENBQUMsV0FBVyxDQUFDO1FBQ2hELE1BQU0sSUFBSSxHQUFHLGlDQUFjLENBQUMsT0FBTyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsWUFBWSxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUM7UUFDcEUsTUFBTSxrQkFBa0IsR0FBRyx1REFBeUIsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDbEUsTUFBTSxJQUFJLEdBQUcsa0JBQWtCLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ2xELFlBQUcsQ0FBQyxNQUFNLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDO1FBQ3hCLE9BQU8sTUFBTSxDQUFDO0lBQ2hCLENBQUMsQ0FBQztBQUNKLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBDb3B5cmlnaHQgRWxhc3RpY3NlYXJjaCBCLlYuIGFuZC9vciBsaWNlbnNlZCB0byBFbGFzdGljc2VhcmNoIEIuVi4gdW5kZXIgb25lXG4gKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxpY2Vuc2UgYWdyZWVtZW50cy4gTGljZW5zZWQgdW5kZXIgdGhlIEVsYXN0aWMgTGljZW5zZTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgRWxhc3RpYyBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7IGNsb25lRGVlcCwgc2V0IH0gZnJvbSAnbG9kYXNoJztcbmltcG9ydCB7IEluZnJhRVNTZWFyY2hCb2R5LCBJbmZyYVByb2Nlc29yUmVxdWVzdE9wdGlvbnMgfSBmcm9tICcuLi8uLi9hZGFwdGVyX3R5cGVzJztcbmltcG9ydCB7IGNyZWF0ZUJhc2VQYXRoIH0gZnJvbSAnLi4vLi4vbGliL2NyZWF0ZV9iYXNlX3BhdGgnO1xuaW1wb3J0IHsgbWV0cmljQWdncmVnYXRpb25DcmVhdG9ycyB9IGZyb20gJy4uLy4uL21ldHJpY19hZ2dyZWdhdGlvbl9jcmVhdG9ycyc7XG5cbmV4cG9ydCBjb25zdCBtZXRyaWNCdWNrZXRzUHJvY2Vzc29yID0gKG9wdGlvbnM6IEluZnJhUHJvY2Vzb3JSZXF1ZXN0T3B0aW9ucykgPT4ge1xuICByZXR1cm4gKGRvYzogSW5mcmFFU1NlYXJjaEJvZHkpID0+IHtcbiAgICBjb25zdCByZXN1bHQgPSBjbG9uZURlZXAoZG9jKTtcbiAgICBjb25zdCB7IG1ldHJpYywgZ3JvdXBCeSB9ID0gb3B0aW9ucy5ub2RlT3B0aW9ucztcbiAgICBjb25zdCBwYXRoID0gY3JlYXRlQmFzZVBhdGgoZ3JvdXBCeSkuY29uY2F0KFsndGltZXNlcmllcycsICdhZ2dzJ10pO1xuICAgIGNvbnN0IGFnZ3JlZ2F0aW9uQ3JlYXRvciA9IG1ldHJpY0FnZ3JlZ2F0aW9uQ3JlYXRvcnNbbWV0cmljLnR5cGVdO1xuICAgIGNvbnN0IGFnZ3MgPSBhZ2dyZWdhdGlvbkNyZWF0b3Iob3B0aW9ucy5ub2RlVHlwZSk7XG4gICAgc2V0KHJlc3VsdCwgcGF0aCwgYWdncyk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfTtcbn07XG4iXX0=