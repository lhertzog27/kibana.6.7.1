"use strict";
/*
 * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one
 * or more contributor license agreements. Licensed under the Elastic License;
 * you may not use this file except in compliance with the Elastic License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
const lodash_1 = require("lodash");
const ts_optchain_1 = require("ts-optchain");
function anomalySeriesTransform(response, mlBucketSize, bucketSize, timeSeriesDates) {
    if (!response) {
        return;
    }
    const buckets = ts_optchain_1.oc(response)
        .aggregations.ml_avg_response_times.buckets([])
        .map(bucket => {
        return {
            x: bucket.key,
            anomalyScore: bucket.anomaly_score.value,
            lower: bucket.lower.value,
            upper: bucket.upper.value
        };
    });
    const bucketSizeInMillis = Math.max(bucketSize, mlBucketSize) * 1000;
    return {
        anomalyScore: getAnomalyScoreDataPoints(buckets, timeSeriesDates, bucketSizeInMillis),
        anomalyBoundaries: getAnomalyBoundaryDataPoints(buckets, timeSeriesDates)
    };
}
exports.anomalySeriesTransform = anomalySeriesTransform;
function getAnomalyScoreDataPoints(buckets, timeSeriesDates, bucketSizeInMillis) {
    const ANOMALY_THRESHOLD = 75;
    const firstDate = lodash_1.first(timeSeriesDates);
    const lastDate = lodash_1.last(timeSeriesDates);
    return buckets
        .filter(bucket => bucket.anomalyScore !== null && bucket.anomalyScore > ANOMALY_THRESHOLD)
        .filter(isInDateRange(firstDate, lastDate))
        .map(bucket => {
        return {
            x0: bucket.x,
            x: Math.min(bucket.x + bucketSizeInMillis, lastDate) // don't go beyond last date
        };
    });
}
exports.getAnomalyScoreDataPoints = getAnomalyScoreDataPoints;
function getAnomalyBoundaryDataPoints(buckets, timeSeriesDates) {
    return replaceFirstAndLastBucket(buckets, timeSeriesDates)
        .filter(bucket => bucket.lower !== null)
        .map(bucket => {
        return {
            x: bucket.x,
            y0: bucket.lower,
            y: bucket.upper
        };
    });
}
exports.getAnomalyBoundaryDataPoints = getAnomalyBoundaryDataPoints;
function replaceFirstAndLastBucket(buckets, timeSeriesDates) {
    const firstDate = lodash_1.first(timeSeriesDates);
    const lastDate = lodash_1.last(timeSeriesDates);
    const preBucketWithValue = buckets
        .filter(p => p.x <= firstDate)
        .reverse()
        .find(p => p.lower !== null);
    const bucketsInRange = buckets.filter(isInDateRange(firstDate, lastDate));
    // replace first bucket if it is null
    const firstBucket = lodash_1.first(bucketsInRange);
    if (preBucketWithValue && firstBucket && firstBucket.lower === null) {
        firstBucket.lower = preBucketWithValue.lower;
        firstBucket.upper = preBucketWithValue.upper;
    }
    const lastBucketWithValue = [...buckets]
        .reverse()
        .find(p => p.lower !== null);
    // replace last bucket if it is null
    const lastBucket = lodash_1.last(bucketsInRange);
    if (lastBucketWithValue && lastBucket && lastBucket.lower === null) {
        lastBucket.lower = lastBucketWithValue.lower;
        lastBucket.upper = lastBucketWithValue.upper;
    }
    return bucketsInRange;
}
exports.replaceFirstAndLastBucket = replaceFirstAndLastBucket;
// anomaly time series contain one or more buckets extra in the beginning
// these extra buckets should be removed
function isInDateRange(firstDate, lastDate) {
    return (p) => p.x >= firstDate && p.x <= lastDate;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiL2hvbWUvYW50aG9ueS9naXRfd29ya3NwYWNlcy9raWJhbmEveC1wYWNrL3BsdWdpbnMvYXBtL3NlcnZlci9saWIvdHJhbnNhY3Rpb25zL2NoYXJ0cy9nZXRfYW5vbWFseV9kYXRhL3RyYW5zZm9ybS50cyIsInNvdXJjZXMiOlsiL2hvbWUvYW50aG9ueS9naXRfd29ya3NwYWNlcy9raWJhbmEveC1wYWNrL3BsdWdpbnMvYXBtL3NlcnZlci9saWIvdHJhbnNhY3Rpb25zL2NoYXJ0cy9nZXRfYW5vbWFseV9kYXRhL3RyYW5zZm9ybS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUE7Ozs7R0FJRzs7QUFFSCxtQ0FBcUM7QUFDckMsNkNBQWlDO0FBbUJqQyxTQUFnQixzQkFBc0IsQ0FDcEMsUUFBZ0MsRUFDaEMsWUFBb0IsRUFDcEIsVUFBa0IsRUFDbEIsZUFBeUI7SUFFekIsSUFBSSxDQUFDLFFBQVEsRUFBRTtRQUNiLE9BQU87S0FDUjtJQUVELE1BQU0sT0FBTyxHQUFHLGdCQUFFLENBQUMsUUFBUSxDQUFDO1NBQ3pCLFlBQVksQ0FBQyxxQkFBcUIsQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDO1NBQzlDLEdBQUcsQ0FBQyxNQUFNLENBQUMsRUFBRTtRQUNaLE9BQU87WUFDTCxDQUFDLEVBQUUsTUFBTSxDQUFDLEdBQUc7WUFDYixZQUFZLEVBQUUsTUFBTSxDQUFDLGFBQWEsQ0FBQyxLQUFLO1lBQ3hDLEtBQUssRUFBRSxNQUFNLENBQUMsS0FBSyxDQUFDLEtBQUs7WUFDekIsS0FBSyxFQUFFLE1BQU0sQ0FBQyxLQUFLLENBQUMsS0FBSztTQUMxQixDQUFDO0lBQ0osQ0FBQyxDQUFDLENBQUM7SUFFTCxNQUFNLGtCQUFrQixHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsVUFBVSxFQUFFLFlBQVksQ0FBQyxHQUFHLElBQUksQ0FBQztJQUVyRSxPQUFPO1FBQ0wsWUFBWSxFQUFFLHlCQUF5QixDQUNyQyxPQUFPLEVBQ1AsZUFBZSxFQUNmLGtCQUFrQixDQUNu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QixJQUFJLFVBQVUsSUFBSSxVQUFVLENBQUMsS0FBSyxLQUFLLElBQUksRUFBRTtRQUNsRSxVQUFVLENBQUMsS0FBSyxHQUFHLG1CQUFtQixDQUFDLEtBQUssQ0FBQztRQUM3QyxVQUFVLENBQUMsS0FBSyxHQUFHLG1CQUFtQixDQUFDLEtBQUssQ0FBQztLQUM5QztJQUVELE9BQU8sY0FBYyxDQUFDO0FBQ3hCLENBQUM7QUFqQ0QsOERBaUNDO0FBRUQseUVBQXlFO0FBQ3pFLHdDQUF3QztBQUN4QyxTQUFTLGFBQWEsQ0FBQyxTQUFpQixFQUFFLFFBQWdCO0lBQ3hELE9BQU8sQ0FBQyxDQUFVLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksU0FBUyxJQUFJLENBQUMsQ0FBQyxDQUFDLElBQUksUUFBUSxDQUFDO0FBQzdELENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogQ29weXJpZ2h0IEVsYXN0aWNzZWFyY2ggQi5WLiBhbmQvb3IgbGljZW5zZWQgdG8gRWxhc3RpY3NlYXJjaCBCLlYuIHVuZGVyIG9uZVxuICogb3IgbW9yZSBjb250cmlidXRvciBsaWNlbnNlIGFncmVlbWVudHMuIExpY2Vuc2VkIHVuZGVyIHRoZSBFbGFzdGljIExpY2Vuc2U7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIEVsYXN0aWMgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQgeyBmaXJzdCwgbGFzdCB9IGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgeyBvYyB9IGZyb20gJ3RzLW9wdGNoYWluJztcbmltcG9ydCB7XG4gIENvb3JkaW5hdGUsXG4gIFJlY3RDb29yZGluYXRlXG59IGZyb20gJ3gtcGFjay9wbHVnaW5zL2FwbS90eXBpbmdzL3RpbWVzZXJpZXMnO1xuaW1wb3J0IHsgRVNSZXNwb25zZSB9IGZyb20gJy4vZmV0Y2hlcic7XG5cbmludGVyZmFjZSBJQnVja2V0IHtcbiAgeDogbnVtYmVyO1xuICBhbm9tYWx5U2NvcmU6IG51bWJlciB8IG51bGw7XG4gIGxvd2VyOiBudW1iZXIgfCBudWxsO1xuICB1cHBlcjogbnVtYmVyIHwgbnVsbDtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBBbm9tYWx5VGltZVNlcmllc1Jlc3BvbnNlIHtcbiAgYW5vbWFseVNjb3JlOiBSZWN0Q29vcmRpbmF0ZVtdO1xuICBhbm9tYWx5Qm91bmRhcmllczogQ29vcmRpbmF0ZVtdO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gYW5vbWFseVNlcmllc1RyYW5zZm9ybShcbiAgcmVzcG9uc2U6IEVTUmVzcG9uc2UgfCB1bmRlZmluZWQsXG4gIG1sQnVja2V0U2l6ZTogbnVtYmVyLFxuICBidWNrZXRTaXplOiBudW1iZXIsXG4gIHRpbWVTZXJpZXNEYXRlczogbnVtYmVyW11cbik6IEFub21hbHlUaW1lU2VyaWVzUmVzcG9uc2UgfCB1bmRlZmluZWQge1xuICBpZiAoIXJlc3BvbnNlKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgYnVja2V0cyA9IG9jKHJlc3BvbnNlKVxuICAgIC5hZ2dyZWdhdGlvbnMubWxfYXZnX3Jlc3BvbnNlX3RpbWVzLmJ1Y2tldHMoW10pXG4gICAgLm1hcChidWNrZXQgPT4ge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgeDogYnVja2V0LmtleSxcbiAgICAgICAgYW5vbWFseVNjb3JlOiBidWNrZXQuYW5vbWFseV9zY29yZS52YWx1ZSxcbiAgICAgICAgbG93ZXI6IGJ1Y2tldC5sb3dlci52YWx1ZSxcbiAgICAgICAgdXBwZXI6IGJ1Y2tldC51cHBlci52YWx1ZVxuICAgICAgfTtcbiAgICB9KTtcblxuICBjb25zdCBidWNrZXRTaXplSW5NaWxsaXMgPSBNYXRoLm1heChidWNrZXRTaXplLCBtbEJ1Y2tldFNpemUpICogMTAwMDtcblxuICByZXR1cm4ge1xuICAgIGFub21hbHlTY29yZTogZ2V0QW5vbWFseVNjb3JlRGF0YVBvaW50cyhcbiAgICAgIGJ1Y2tldHMsXG4gICAgICB0aW1lU2VyaWVzRGF0ZXMsXG4gICAgICBidWNrZXRTaXplSW5NaWxsaXNcbiAgICApLFxuICAgIGFub21hbHlCb3VuZGFyaWVzOiBnZXRBbm9tYWx5Qm91bmRhcnlEYXRhUG9pbnRzKGJ1Y2tldHMsIHRpbWVTZXJpZXNEYXRlcylcbiAgfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldEFub21hbHlTY29yZURhdGFQb2ludHMoXG4gIGJ1Y2tldHM6IElCdWNrZXRbXSxcbiAgdGltZVNlcmllc0RhdGVzOiBudW1iZXJbXSxcbiAgYnVja2V0U2l6ZUluTWlsbGlzOiBudW1iZXJcbik6IFJlY3RDb29yZGluYXRlW10ge1xuICBjb25zdCBBTk9NQUxZX1RIUkVTSE9MRCA9IDc1O1xuICBjb25zdCBmaXJzdERhdGUgPSBmaXJzdCh0aW1lU2VyaWVzRGF0ZXMpO1xuICBjb25zdCBsYXN0RGF0ZSA9IGxhc3QodGltZVNlcmllc0RhdGVzKTtcblxuICByZXR1cm4gYnVja2V0c1xuICAgIC5maWx0ZXIoXG4gICAgICBidWNrZXQgPT5cbiAgICAgICAgYnVja2V0LmFub21hbHlTY29yZSAhPT0gbnVsbCAmJiBidWNrZXQuYW5vbWFseVNjb3JlID4gQU5PTUFMWV9USFJFU0hPTERcbiAgICApXG4gICAgLmZpbHRlcihpc0luRGF0ZVJhbmdlKGZpcnN0RGF0ZSwgbGFzdERhdGUpKVxuICAgIC5tYXAoYnVja2V0ID0+IHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHgwOiBidWNrZXQueCxcbiAgICAgICAgeDogTWF0aC5taW4oYnVja2V0LnggKyBidWNrZXRTaXplSW5NaWxsaXMsIGxhc3REYXRlKSAvLyBkb24ndCBnbyBiZXlvbmQgbGFzdCBkYXRlXG4gICAgICB9O1xuICAgIH0pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0QW5vbWFseUJvdW5kYXJ5RGF0YVBvaW50cyhcbiAgYnVja2V0czogSUJ1Y2tldFtdLFxuICB0aW1lU2VyaWVzRGF0ZXM6IG51bWJlcltdXG4pOiBDb29yZGluYXRlW10ge1xuICByZXR1cm4gcmVwbGFjZUZpcnN0QW5kTGFzdEJ1Y2tldChidWNrZXRzLCB0aW1lU2VyaWVzRGF0ZXMpXG4gICAgLmZpbHRlcihidWNrZXQgPT4gYnVja2V0Lmxvd2VyICE9PSBudWxsKVxuICAgIC5tYXAoYnVja2V0ID0+IHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHg6IGJ1Y2tldC54LFxuICAgICAgICB5MDogYnVja2V0Lmxvd2VyLFxuICAgICAgICB5OiBidWNrZXQudXBwZXJcbiAgICAgIH07XG4gICAgfSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiByZXBsYWNlRmlyc3RBbmRMYXN0QnVja2V0KFxuICBidWNrZXRzOiBJQnVja2V0W10sXG4gIHRpbWVTZXJpZXNEYXRlczogbnVtYmVyW11cbikge1xuICBjb25zdCBmaXJzdERhdGUgPSBmaXJzdCh0aW1lU2VyaWVzRGF0ZXMpO1xuICBjb25zdCBsYXN0RGF0ZSA9IGxhc3QodGltZVNlcmllc0RhdGVzKTtcblxuICBjb25zdCBwcmVCdWNrZXRXaXRoVmFsdWUgPSBidWNrZXRzXG4gICAgLmZpbHRlcihwID0+IHAueCA8PSBmaXJzdERhdGUpXG4gICAgLnJldmVyc2UoKVxuICAgIC5maW5kKHAgPT4gcC5sb3dlciAhPT0gbnVsbCk7XG5cbiAgY29uc3QgYnVja2V0c0luUmFuZ2UgPSBidWNrZXRzLmZpbHRlcihpc0luRGF0ZVJhbmdlKGZpcnN0RGF0ZSwgbGFzdERhdGUpKTtcblxuICAvLyByZXBsYWNlIGZpcnN0IGJ1Y2tldCBpZiBpdCBpcyBudWxsXG4gIGNvbnN0IGZpcnN0QnVja2V0ID0gZmlyc3QoYnVja2V0c0luUmFuZ2UpO1xuICBpZiAocHJlQnVja2V0V2l0aFZhbHVlICYmIGZpcnN0QnVja2V0ICYmIGZpcnN0QnVja2V0Lmxvd2VyID09PSBudWxsKSB7XG4gICAgZmlyc3RCdWNrZXQubG93ZXIgPSBwcmVCdWNrZXRXaXRoVmFsdWUubG93ZXI7XG4gICAgZmlyc3RCdWNrZXQudXBwZXIgPSBwcmVCdWNrZXRXaXRoVmFsdWUudXBwZXI7XG4gIH1cblxuICBjb25zdCBsYXN0QnVja2V0V2l0aFZhbHVlID0gWy4uLmJ1Y2tldHNdXG4gICAgLnJldmVyc2UoKVxuICAgIC5maW5kKHAgPT4gcC5sb3dlciAhPT0gbnVsbCk7XG5cbiAgLy8gcmVwbGFjZSBsYXN0IGJ1Y2tldCBpZiBpdCBpcyBudWxsXG4gIGNvbnN0IGxhc3RCdWNrZXQgPSBsYXN0KGJ1Y2tldHNJblJhbmdlKTtcbiAgaWYgKGxhc3RCdWNrZXRXaXRoVmFsdWUgJiYgbGFzdEJ1Y2tldCAmJiBsYXN0QnVja2V0Lmxvd2VyID09PSBudWxsKSB7XG4gICAgbGFzdEJ1Y2tldC5sb3dlciA9IGxhc3RCdWNrZXRXaXRoVmFsdWUubG93ZXI7XG4gICAgbGFzdEJ1Y2tldC51cHBlciA9IGxhc3RCdWNrZXRXaXRoVmFsdWUudXBwZXI7XG4gIH1cblxuICByZXR1cm4gYnVja2V0c0luUmFuZ2U7XG59XG5cbi8vIGFub21hbHkgdGltZSBzZXJpZXMgY29udGFpbiBvbmUgb3IgbW9yZSBidWNrZXRzIGV4dHJhIGluIHRoZSBiZWdpbm5pbmdcbi8vIHRoZXNlIGV4dHJhIGJ1Y2tldHMgc2hvdWxkIGJlIHJlbW92ZWRcbmZ1bmN0aW9uIGlzSW5EYXRlUmFuZ2UoZmlyc3REYXRlOiBudW1iZXIsIGxhc3REYXRlOiBudW1iZXIpIHtcbiAgcmV0dXJuIChwOiBJQnVja2V0KSA9PiBwLnggPj0gZmlyc3REYXRlICYmIHAueCA8PSBsYXN0RGF0ZTtcbn1cbiJdfQ==