"use strict";
/*
 * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one
 * or more contributor license agreements. Licensed under the Elastic License;
 * you may not use this file except in compliance with the Elastic License.
 */
Object.defineProperty(exports, "__esModule", { value: true });
const lodash_1 = require("lodash");
const isJsonObject = (subject) => {
    return lodash_1.isPlainObject(subject);
};
const serializeValue = (value) => {
    if (lodash_1.isArray(value) || lodash_1.isPlainObject(value)) {
        return JSON.stringify(value);
    }
    return `${value}`;
};
exports.convertDocumentSourceToLogItemFields = (source, path = [], fields = []) => {
    return Object.keys(source).reduce((acc, key) => {
        const value = source[key];
        const nextPath = [...path, key];
        if (isJsonObject(value)) {
            return exports.convertDocumentSourceToLogItemFields(value, nextPath, acc);
        }
        const field = { field: nextPath.join('.'), value: serializeValue(value) };
        return [...acc, field];
    }, fields);
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiL2hvbWUvYW50aG9ueS9naXRfd29ya3NwYWNlcy9raWJhbmEveC1wYWNrL3BsdWdpbnMvaW5mcmEvc2VydmVyL2xpYi9kb21haW5zL2xvZ19lbnRyaWVzX2RvbWFpbi9jb252ZXJ0X2RvY3VtZW50X3NvdXJjZV90b19sb2dfaXRlbV9maWVsZHMudHMiLCJzb3VyY2VzIjpbIi9ob21lL2FudGhvbnkvZ2l0X3dvcmtzcGFjZXMva2liYW5hL3gtcGFjay9wbHVnaW5zL2luZnJhL3NlcnZlci9saWIvZG9tYWlucy9sb2dfZW50cmllc19kb21haW4vY29udmVydF9kb2N1bWVudF9zb3VyY2VfdG9fbG9nX2l0ZW1fZmllbGRzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQTs7OztHQUlHOztBQUVILG1DQUFnRDtBQUloRCxNQUFNLFlBQVksR0FBRyxDQUFDLE9BQVksRUFBeUIsRUFBRTtJQUMzRCxPQUFPLHNCQUFhLENBQUMsT0FBTyxDQUFDLENBQUM7QUFDaEMsQ0FBQyxDQUFDO0FBRUYsTUFBTSxjQUFjLEdBQUcsQ0FBQyxLQUFVLEVBQVUsRUFBRTtJQUM1QyxJQUFJLGdCQUFPLENBQUMsS0FBSyxDQUFDLElBQUksc0JBQWEsQ0FBQyxLQUFLLENBQUMsRUFBRTtRQUMxQyxPQUFPLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUM7S0FDOUI7SUFDRCxPQUFPLEdBQUcsS0FBSyxFQUFFLENBQUM7QUFDcEIsQ0FBQyxDQUFDO0FBRVcsUUFBQSxvQ0FBb0MsR0FBRyxDQUNsRCxNQUFrQixFQUNsQixPQUFpQixFQUFFLEVBQ25CLFNBQThCLEVBQUUsRUFDWCxFQUFFO0lBQ3ZCLE9BQU8sTUFBTSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLEVBQUU7UUFDN0MsTUFBTSxLQUFLLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQzFCLE1BQU0sUUFBUSxHQUFHLENBQUMsR0FBRyxJQUFJLEVBQUUsR0FBRyxDQUFDLENBQUM7UUFDaEMsSUFBSSxZQUFZLENBQUMsS0FBSyxDQUFDLEVBQUU7WUFDdkIsT0FBTyw0Q0FBb0MsQ0FBQyxLQUFLLEVBQUUsUUFBUSxFQUFFLEdBQUcsQ0FBQyxDQUFDO1NBQ25FO1FBQ0QsTUFBTSxLQUFLLEdBQUcsRUFBRSxLQUFLLEVBQUUsUUFBUSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxLQUFLLEVBQUUsY0FBYyxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUM7UUFDMUUsT0FBTyxDQUFDLEdBQUcsR0FBRyxFQUFFLEtBQUssQ0FBQyxDQUFDO0lBQ3pCLENBQUMsRUFBRSxNQUFNLENBQUMsQ0FBQztBQUNiLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBDb3B5cmlnaHQgRWxhc3RpY3NlYXJjaCBCLlYuIGFuZC9vciBsaWNlbnNlZCB0byBFbGFzdGljc2VhcmNoIEIuVi4gdW5kZXIgb25lXG4gKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxpY2Vuc2UgYWdyZWVtZW50cy4gTGljZW5zZWQgdW5kZXIgdGhlIEVsYXN0aWMgTGljZW5zZTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgRWxhc3RpYyBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7IGlzQXJyYXksIGlzUGxhaW5PYmplY3QgfSBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHsgSnNvbk9iamVjdCB9IGZyb20gJ3gtcGFjay9wbHVnaW5zL2luZnJhL2NvbW1vbi90eXBlZF9qc29uJztcbmltcG9ydCB7IEluZnJhTG9nSXRlbUZpZWxkIH0gZnJvbSAnLi4vLi4vLi4vZ3JhcGhxbC90eXBlcyc7XG5cbmNvbnN0IGlzSnNvbk9iamVjdCA9IChzdWJqZWN0OiBhbnkpOiBzdWJqZWN0IGlzIEpzb25PYmplY3QgPT4ge1xuICByZXR1cm4gaXNQbGFpbk9iamVjdChzdWJqZWN0KTtcbn07XG5cbmNvbnN0IHNlcmlhbGl6ZVZhbHVlID0gKHZhbHVlOiBhbnkpOiBzdHJpbmcgPT4ge1xuICBpZiAoaXNBcnJheSh2YWx1ZSkgfHwgaXNQbGFpbk9iamVjdCh2YWx1ZSkpIHtcbiAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkodmFsdWUpO1xuICB9XG4gIHJldHVybiBgJHt2YWx1ZX1gO1xufTtcblxuZXhwb3J0IGNvbnN0IGNvbnZlcnREb2N1bWVudFNvdXJjZVRvTG9nSXRlbUZpZWxkcyA9IChcbiAgc291cmNlOiBKc29uT2JqZWN0LFxuICBwYXRoOiBzdHJpbmdbXSA9IFtdLFxuICBmaWVsZHM6IEluZnJhTG9nSXRlbUZpZWxkW10gPSBbXVxuKTogSW5mcmFMb2dJdGVtRmllbGRbXSA9PiB7XG4gIHJldHVybiBPYmplY3Qua2V5cyhzb3VyY2UpLnJlZHVjZSgoYWNjLCBrZXkpID0+IHtcbiAgICBjb25zdCB2YWx1ZSA9IHNvdXJjZVtrZXldO1xuICAgIGNvbnN0IG5leHRQYXRoID0gWy4uLnBhdGgsIGtleV07XG4gICAgaWYgKGlzSnNvbk9iamVjdCh2YWx1ZSkpIHtcbiAgICAgIHJldHVybiBjb252ZXJ0RG9jdW1lbnRTb3VyY2VUb0xvZ0l0ZW1GaWVsZHModmFsdWUsIG5leHRQYXRoLCBhY2MpO1xuICAgIH1cbiAgICBjb25zdCBmaWVsZCA9IHsgZmllbGQ6IG5leHRQYXRoLmpvaW4oJy4nKSwgdmFsdWU6IHNlcmlhbGl6ZVZhbHVlKHZhbHVlKSB9O1xuICAgIHJldHVybiBbLi4uYWNjLCBmaWVsZF07XG4gIH0sIGZpZWxkcyk7XG59O1xuIl19